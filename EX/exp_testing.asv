%testing multigrid solver against cg 
%rhs s.t. x_exc is ones
%x0 
addpath("1D");
lvl_1d = [2; 3; 4];

meshes_1d = [32, 64, 128, 256, 512, 1024];

outfile = fopen('results.txt','w');

maxit = 2000;
tol = 1e-10;

for max_lvl = lvl_1d
    fprintf(outfile,"\n ++++++++++++++++++++++ \n");
    fprintf(outfile,"V-Cycle levels %d \n", max_lvl);
    for N = meshes_1d
        fprintf(outfile,"\t Mesh subdivisions (1D) %d \n",N);
        A = L1D(N);
        x_exc = ones(size(A,1),1);
        x0 = 
        b = A*x_exc;
        tic();
        [xmg, img, resmg ] = MG_1D_gen(A,b,x0,maxit,tol,max_lvl)
        tmg = toc();
        
        tic();
        [xcg, icg, rescg] = mypcg(A,b,x0,maxit,tol,speye(size(A,1)));
        tcg = toc();
        
        rate_mg = -log10(norm(x_exc - xmg)/norm(x_exc - x0))/img;
        rate_cg = -log10(norm(x_exc - xcg)/norm(x_exc - x0))/icg;
        
        fprintf(outfile, "\t\t MultiGrid >>> Iter: %d  Conv Rate: %e  err norm: %e \n", img, rate_mg, norm(x_exc - xmg));
        fprintf(outfile, "\t\t CG        >>> Iter: %d  Conv Rate: %e  err norm: %e \n", icg, rate_cg, norm(x_exc - xcg));

        
        
        
        
    end
    
end


